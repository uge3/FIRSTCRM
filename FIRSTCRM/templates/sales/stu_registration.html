{% extends 'master/base.html' %}
{% load crm_tags %}
{% block body %}

    <div class="container col-lg-7 col-md-offset-2">
        <div class="panel panel-warning">

            <div class=" panel-heading">
                <h3 class="panel-title container">报名入学｜信息填写</h3>
            </div>

            <div class="panel-body ">                           <!--返回提交函数-->
            {% if status != 1 %}

            <span class="errors">{{ customer_form.errors }}</span><!--错误提示-->
                <form method="post" class="form-horizontal" role="form" onsubmit="return RegisterFormCheck()">{% csrf_token %}
                    {% for foo in customer_form %}
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">{{ foo.label }}</label>
                        <div class="col-sm-8">
                          {{ foo }}
                        </div>
                    </div>
                {% endfor %}
                    <hr>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">所报班级</label>
                    <div class="col-sm-8">
                      {{ enroll_obj.enrolled_class }}
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">课程费用</label>
                    <div class="col-sm-8">
                      {{ enroll_obj.enrolled_class.course.price }}
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">开课日期</label>
                    <div class="col-sm-8">
                      {{ enroll_obj.enrolled_class.start_date }}
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">合同</label>
                    <div class="col-sm-10">
                        <div style="width: 500px">
                            <pre>{% render_enrolled_contract enroll_obj %}  </pre>
                        </div>

                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <input type="checkbox" value="{{ enroll_obj.contract_agreed }}" name="contract_agreed" checked>
                        我已经认真阅读完协议并接受所有条款
                    </div>

                </div>
                <div class="text-center">
                    <input type="submit" class="btn btn-info" value="提交">
                </div>
                </form>

                <p>请上传身份证反面照片</p>
                <form action="{{ request.path }}" class="dropzone" id="filerdropzone" method="post">{% csrf_token %}
                   <div class="dz-default dz-message">
                       <div class="dz-icon icon-wrap icon-circle icon-wrap-md">
                           <i class="fa fa-cloud-upload fa-3x"></i>
                       </div>

                    <div>
                        <p class="container">请将照片拖到这里或点击上传</p>
                    </div>
                </div>
               </form>


            {% else %}
                <h3>报名成功，同合进入审核流程，感谢您的选择！</h3>
            {% endif %}
            </div>

            <div class="panel-footer">
                <input type="button" class="btn btn-danger right" value="关闭" onclick="CloseWebPage()">
            </div>
        </div>

    </div>

{% endblock %}

{% block js %}
    <script>
    function CloseWebPage(){
    if (confirm("您确定要关闭本页吗？")){
    window.opener=null;
    window.open('','_self');
    window.close();
    }
    else{}     
    }

    function RegisterFormCheck(){
        if (myDropzone.files.length < 2){
            alert('请上传身份证正反面！2张！)');
            return false;
        }
        if ($('form :checkbox').prop("checked")){
            $("form").find("[disabled]").removeAttr("disabled");//移除不可修改 便于提交表单
            return true;
        }else {
            alert('请认真阅读并且同意条款，才可以报名');
            return false;
        }
    }
    Dropzone.autoDiscover=false;
    myDropzone=new Dropzone('#filerdropzone');
    myDropzone.on('addedfile',function(file){
        //判断是否有上传文件
        console.log('_+_+_+_+_',file);
    });
    $(document).ready(function(){//上传图片
        Dropzone.options.filedr={
            url:'{{ requset.path }}',//路径为 当前页
            paramName:'file',//文件格式
            maxFilesize:1,//MB
            addRemvoeLinks:true,
            maxFiles:5,
            uploadMultiple:true,
            accept:function(file,done){
                if (file.name == "justinbieber.jpg"){
                    done ("不能上传文件");
                }
            }
        }
    })


    </script>
{% endblock %}